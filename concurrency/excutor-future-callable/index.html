<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Some notes for daily dev for java related"><meta name=author content="Xu Kaixuan"><link href=https://xkx9431.github.io/dev-notes-java/concurrency/excutor-future-callable/ rel=canonical><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.2.3, mkdocs-material-7.3.4"><title>Executor Pattern, Futures and Callables - Dev notes for Java</title><link rel=stylesheet href=../../assets/stylesheets/main.db9e7362.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.3f5d1f46.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script> <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#executor class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Dev notes for Java" class="md-header__button md-logo" aria-label="Dev notes for Java" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M16.5 6.08s-6.84 1.71-3.56 5.48c.97 1.11-.25 2.11-.25 2.11s2.45-1.25 1.31-2.85c-1.06-1.47-1.86-2.2 2.5-4.74m-4.47 1.2C16.08 4.08 14 2 14 2c.84 3.3-2.96 4.3-4.33 6.36-.94 1.4.46 2.91 2.33 4.64-.71-1.7-3.22-3.16.03-5.72M9.37 17.47c-3.08.86 1.88 2.63 5.79.96-.38-.15-.75-.33-1.1-.54-1.36.31-2.76.37-4.14.18-1.31-.16-.55-.6-.55-.6m5.32-1.68c-1.75.38-3.56.47-5.34.26-1.31-.13-.45-.77-.45-.77-3.4 1.13 1.88 2.4 6.6 1.02-.29-.11-.57-.3-.81-.51m3.42 3.3s.57.47-.61.83c-2.28.68-9.43.89-11.41.03-.71-.31.63-.74 1.05-.83.23-.06.46-.08.69-.08-.79-.54-5.13 1.1-2.19 1.56 7.97 1.3 14.54-.6 12.47-1.51m-2.74-4.86c.29-.19.6-.35.92-.49 0 0-1.51.26-3.02.4-1.6.16-3.21.18-4.81.06-2.35-.31 1.29-1.2 1.29-1.2-1.1 0-2.18.26-3.16.75-2.05 1 5.1 1.45 8.78.48m.9 2.42c-.02.04-.04.07-.08.1 5.01-1.31 3.17-4.64.77-3.81-.13.06-.24.14-.31.25.14-.05.28-.09.43-.12 1.2-.24 2.92 1.63-.81 3.58m.13 4.61c-3.01.52-6.09.56-9.12.14 0 0 .46.38 2.81.53 3.6.23 9.13-.13 9.26-1.83.03.01-.23.65-2.95 1.16z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Dev notes for Java </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Executor Pattern, Futures and Callables </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=blue aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08z"/></svg> </a> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/xkx9431/dev-notes-java/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> dev-notes-java </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../jvm/ class=md-tabs__link> JVM </a> </li> <li class=md-tabs__item> <a href=../ class="md-tabs__link md-tabs__link--active"> Concurrency </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Dev notes for Java" class="md-nav__button md-logo" aria-label="Dev notes for Java" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M16.5 6.08s-6.84 1.71-3.56 5.48c.97 1.11-.25 2.11-.25 2.11s2.45-1.25 1.31-2.85c-1.06-1.47-1.86-2.2 2.5-4.74m-4.47 1.2C16.08 4.08 14 2 14 2c.84 3.3-2.96 4.3-4.33 6.36-.94 1.4.46 2.91 2.33 4.64-.71-1.7-3.22-3.16.03-5.72M9.37 17.47c-3.08.86 1.88 2.63 5.79.96-.38-.15-.75-.33-1.1-.54-1.36.31-2.76.37-4.14.18-1.31-.16-.55-.6-.55-.6m5.32-1.68c-1.75.38-3.56.47-5.34.26-1.31-.13-.45-.77-.45-.77-3.4 1.13 1.88 2.4 6.6 1.02-.29-.11-.57-.3-.81-.51m3.42 3.3s.57.47-.61.83c-2.28.68-9.43.89-11.41.03-.71-.31.63-.74 1.05-.83.23-.06.46-.08.69-.08-.79-.54-5.13 1.1-2.19 1.56 7.97 1.3 14.54-.6 12.47-1.51m-2.74-4.86c.29-.19.6-.35.92-.49 0 0-1.51.26-3.02.4-1.6.16-3.21.18-4.81.06-2.35-.31 1.29-1.2 1.29-1.2-1.1 0-2.18.26-3.16.75-2.05 1 5.1 1.45 8.78.48m.9 2.42c-.02.04-.04.07-.08.1 5.01-1.31 3.17-4.64.77-3.81-.13.06-.24.14-.31.25.14-.05.28-.09.43-.12 1.2-.24 2.92 1.63-.81 3.58m.13 4.61c-3.01.52-6.09.56-9.12.14 0 0 .46.38 2.81.53 3.6.23 9.13-.13 9.26-1.83.03.01-.23.65-2.95 1.16z"/></svg> </a> Dev notes for Java </label> <div class=md-nav__source> <a href=https://github.com/xkx9431/dev-notes-java/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> dev-notes-java </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <div class="md-nav__link md-nav__link--index "> <a href=../../jvm/ >JVM</a> <label for=__nav_2> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=JVM data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> JVM </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_2 type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2> Memory Management <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Memory Management" data-md-level=2> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Memory Management </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../jvm/mm-overview/ class=md-nav__link> Memory Management </a> </li> <li class=md-nav__item> <a href=../../jvm/mm-introduction/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../jvm/mm-gc-works-internals/ class=md-nav__link> GC Internals </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3 checked> <div class="md-nav__link md-nav__link--index "> <a href=../ >Concurrency</a> <label for=__nav_3> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=Concurrency data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Concurrency </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2 type=checkbox id=__nav_3_2 checked> <label class=md-nav__link for=__nav_3_2> 高级Java并发模式 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=高级Java并发模式 data-md-level=2> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> 高级Java并发模式 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../cp-overview/ class=md-nav__link> 高级Java并发模式 </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Executor Pattern, Futures and Callables <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Executor Pattern, Futures and Callables </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#executor class=md-nav__link> Executor </a> <nav class=md-nav aria-label=Executor> <ul class=md-nav__list> <li class=md-nav__item> <a href=#runnable class=md-nav__link> Runnable模式的问题 </a> </li> <li class=md-nav__item> <a href=#executor_1 class=md-nav__link> Executor 一种启动线程的新模式 </a> </li> <li class=md-nav__item> <a href=#runnable-executor-service class=md-nav__link> Runnable 和 Executor Service 模式 </a> </li> <li class=md-nav__item> <a href=#executor_2 class=md-nav__link> Executor服务模式的总结 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#runnable-callable class=md-nav__link> 从Runnable 到 Callable </a> <nav class=md-nav aria-label="从Runnable 到 Callable"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#runnable_1 class=md-nav__link> Runnable有什么问题？ </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#runnable- class=md-nav__link> Runnable接口 -- 建模任务 </a> <nav class=md-nav aria-label="Runnable接口 -- 建模任务"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#introducing-the-future-object-to-transmit-objects-between-threads class=md-nav__link> Introducing the Future Object to Transmit Objects Between Threads </a> </li> <li class=md-nav__item> <a href=#wrapping-up-callables-and-futures-handling-exceptions class=md-nav__link> Wrapping-up Callables and Futures, Handling Exceptions </a> </li> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 示例代码 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../lock-sema-pro-con/ class=md-nav__link> 在生产者/消费者模式中使用锁和semaphores </a> </li> <li class=md-nav__item> <a href=../barriers-latches/ class=md-nav__link> 使用 Barriers 和 Latches 控制并发的应用程序 </a> </li> <li class=md-nav__item> <a href=../cas-atomic/ class=md-nav__link> 了解 CAS 和原子变量 </a> </li> <li class=md-nav__item> <a href=../concurrent-collections/ class=md-nav__link> Concurrent Collections and Maps </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#executor class=md-nav__link> Executor </a> <nav class=md-nav aria-label=Executor> <ul class=md-nav__list> <li class=md-nav__item> <a href=#runnable class=md-nav__link> Runnable模式的问题 </a> </li> <li class=md-nav__item> <a href=#executor_1 class=md-nav__link> Executor 一种启动线程的新模式 </a> </li> <li class=md-nav__item> <a href=#runnable-executor-service class=md-nav__link> Runnable 和 Executor Service 模式 </a> </li> <li class=md-nav__item> <a href=#executor_2 class=md-nav__link> Executor服务模式的总结 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#runnable-callable class=md-nav__link> 从Runnable 到 Callable </a> <nav class=md-nav aria-label="从Runnable 到 Callable"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#runnable_1 class=md-nav__link> Runnable有什么问题？ </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#runnable- class=md-nav__link> Runnable接口 -- 建模任务 </a> <nav class=md-nav aria-label="Runnable接口 -- 建模任务"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#introducing-the-future-object-to-transmit-objects-between-threads class=md-nav__link> Introducing the Future Object to Transmit Objects Between Threads </a> </li> <li class=md-nav__item> <a href=#wrapping-up-callables-and-futures-handling-exceptions class=md-nav__link> Wrapping-up Callables and Futures, Handling Exceptions </a> </li> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 示例代码 </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/xkx9431/dev-notes-java/edit/main/docs/concurrency/excutor-future-callable.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1>Executor Pattern, Futures and Callables</h1> <p>高级Java并发模式，及其第一个模块，介绍执行器模式、期货和可调用程序。本课程是关于Java中的高级并发，主要是指如何以不同的方式改进Runnable模式。首先，我们将讨论Executor模式以及期货和可调用程序。我们将详细介绍这些内容。然后，我们将讨论引入的用于同步任务的Java原语。这些原语已在Java 5中引入。然后我们将详细介绍比较和交换模式以及原子变量。我们将非常精确地描述这个概念。最后，我们将浏览集合框架中引入的并发集合和地图。在涵盖Java并发原语的模块中，我们将介绍锁和信号灯，它们是同步块模式的替代品，我们将用它们来实现生产者/消费者模式。我们还将讨论障碍物和锁，并看到正确使用它们的模式。</p> <h3 id=executor>Executor<a class=headerlink href=#executor title="Permanent link">&para;</a></h3> <h4 id=runnable>Runnable模式的问题<a class=headerlink href=#runnable title="Permanent link">&para;</a></h4> <p>让我们开始第一部分，关于Executor模式。首先，让我们看一下这段代码。这段代码是Runnable模式的一个实际例子。首先，一个任务是Runnable接口的一个实例。由于这个Runnable接口是一个功能接口，我们可以用一个lambda表达式来实现它。然后，我们创建一个新的线程类的实例，并将这个Runnable作为参数传递给这个对象的构造。最后，我们在这个Thread对象上调用start方法，这将产生在一个新的线程中执行runnable的效果，从而执行这个任务。现在让我们仔细看看这个模式，并尝试了解它的问题所在。第一点是，线程是由用户根据需求创建的。这个用户是一个开发者。现在的风险是，每个人都可以自由地创建新的线程，你可能最终会在你的应用程序中创建成千上万的线程，从而扼杀它。这个想法不是一个好主意。第二，为每个任务创建一个新的线程，当任务完成后，该线程就会死亡。这就是这种启动方法的工作方式。问题是，线程可能是操作系统给的资源，而我们都知道，这些资源无论是创建还是杀死都很昂贵。因此，事实上，这种模式，即使从纯技术角度看是可行的，也不是那么好，不应该在实际应用中使用。事实上，如果你正在开发的是一个Java EE应用程序，你根本就不应该使用它。在Java EE应用程序中，你不允许自己创建新的线程。 <div class=highlight><pre><span></span><code>    <span class=n>Runnable</span> <span class=n>task</span><span class=o>=</span> <span class=p>()</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Hello world!&quot;</span><span class=p>);</span>
    <span class=n>Thread</span> <span class=n>thread</span><span class=o>=</span> <span class=n>newThread</span><span class=p>(</span><span class=n>task</span><span class=p>);</span>
    <span class=n>thread</span><span class=p>.</span><span class=na>start</span><span class=p>();</span>
</code></pre></div></p> <h4 id=executor_1>Executor 一种启动线程的新模式<a class=headerlink href=#executor_1 title="Permanent link">&para;</a></h4> <p>Executor模式的第一个目标正是要解决这些问题。因此，首先，我们怎样才能改善用户线程的资源。我们可以考虑创建随时可以使用的线程池，这是一个非常经典的解决方案，并按需使用它们。因此，我们不是用每个任务作为参数来创建一个新的线程，而是像实现Runnable接口那样创建任务，并将其提交给线程池来执行。线程池的作用将是接受一个任务，选择一个可用的线程，将这个任务传递给这个线程，并在这个线程中执行它。因此，我们至少需要两种模式，第一种模式是创建一个线程池，第二种模式是将一个任务传递给这个线程池。</p> <p>在Java中，一个线程池是一个Executor接口的实例。这个Executor接口非常简单。它只有一个方法，即execute，它需要一个可运行的任务。我们不需要自己去实现这个接口。在JDK中有几个现成的实现。我们有第二个接口，叫做ExecutorService，它扩展了Executor。ExecutorService比Executor多了大约10个方法，但事实上，事实证明，Executor的所有实现也是ExecutorService的实现。两个接口的实现都是一样的。为了创建这些实现的实例，我们有一个名为Executors的工厂类，其中的S有大约20个方法来创建Executor。例如，让我们建立一个只有一个线程的线程池。我们可以使用Executors类中的newSingleThreadExecutor工厂方法。这个线程池是如何工作的呢？事实上，当我们创建它时，这个线程也被创建了，只要这个线程池还活着，它就会一直活着。然后，当我们把一个任务传递给这个ExecutorService时，这个任务就会在这个线程中执行，一旦这个任务完成，这个线程就会被销毁。这就带来了一个问题：我们要如何释放这个ExecutorService的线程。事实上，在ExecutorService中，有一组关闭方法，我们将在这一部分的最后看到。</p> <div class=highlight><pre><span></span><code>    <span class=kd>public</span> <span class=kd>interface</span> <span class=nc>Executor</span> <span class=p>{</span>
        <span class=kt>void</span> <span class=nf>execute</span><span class=p>(</span><span class=n>Runnabletask</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=kd>public</span> <span class=kd>interface</span> <span class=nc>ExecutorService</span> <span class=kd>extends</span> <span class=n>Executor</span> <span class=p>{</span>
        <span class=c1>// 11 more methods</span>
    <span class=p>}</span>
</code></pre></div> <h4 id=runnable-executor-service>Runnable 和 Executor Service 模式<a class=headerlink href=#runnable-executor-service title="Permanent link">&para;</a></h4> <p>我们不会看到Executors工厂类的所有方法。我们将在本模块的现场编码部分看到几个例子。这个类中最常用的两个方法是以下几个。第一个是newSingleThreadExecutor，用来创建一个只有一个线程的线程池。当你只想在另一个线程中执行一个任务时，它对于反应式编程非常有用。第二个是FixedThreadPoolExecutor。它是一个线程池，你可以固定线程的数量，在这个例子中是8。好了，我们可以在一个单线程上创建一个执行器，然后像我们刚才那样创建一个可运行的任务，并将这个任务传递给执行器。将要发生的事情是，执行器将接受这个任务，因为它只有一个线程，所以将在这个线程中执行这个任务。当这个任务完成后，这个线程就可以用来执行另一个任务了。所以我们可以比较这两种模式。在第一种模式中，我们将任务传递给执行器。在第二种模式中，我们将任务传递给一个新的线程实例。所以基本上，Executor模式不会创建一个新的线程，这正是我们想要做的，但行为是一样的。执行方法的调用和启动方法的调用都将立即返回，任务将在未来的某个时间在另一个线程中执行。</p> <div class=highlight><pre><span></span><code>    <span class=n>ExecutorService</span> <span class=n>singleThreadExecutor</span> <span class=o>=</span><span class=n>Executors</span><span class=p>.</span><span class=na>newSingleThreadExecutor</span><span class=p>();</span>
    <span class=n>ExecutorService</span> <span class=n>multipleThreadsExecutor</span> <span class=o>=</span> <span class=n>Executors</span><span class=p>.</span><span class=na>newFixedThreadPoolExecutor</span><span class=p>(</span><span class=mi>8</span><span class=p>);</span>

    <span class=c1>//</span>
    <span class=n>Executor</span> <span class=n>executor</span><span class=o>=</span> <span class=n>Executors</span><span class=p>.</span><span class=na>newSingleThreadExecutor</span><span class=p>();</span>
    <span class=n>Runnable</span> <span class=n>task</span><span class=o>=</span> <span class=p>()</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;I run!&quot;</span><span class=p>);</span>
    <span class=n>executor</span><span class=p>.</span><span class=na>execute</span><span class=p>(</span><span class=n>task</span><span class=p>);</span>

    <span class=c1>// Executor pattern</span>
    <span class=n>executor</span><span class=p>.</span><span class=na>execute</span><span class=p>(</span><span class=n>task</span><span class=p>);</span>
    <span class=c1>// Runnable pattern</span>
    <span class=n>newThread</span><span class=p>(</span><span class=n>task</span><span class=p>).</span><span class=na>start</span><span class=p>();</span>
</code></pre></div> <p>现在假设我们运行这段代码。我们在单线程上创建一个Executor，创建一个需要一定时间执行的第一个任务，以及一个也需要一定时间执行的第二个任务，我们将这两个任务提交给同一个Executor。所以很明显，task2将不得不等待task1的完成。因此，为了处理这种情况，一个Executor，不管它是否是单线程的，都要有等待队列。现在，这个等待队列被精确地指定。它是如何工作的呢？首先，当没有线程可用时，一个任务被添加到等待队列中。因此，假设我们有一个建立在全线程上的ExecutorService，而且所有的线程都很忙。如果一个新的任务被提交，它将被添加到这个等待队列中。第二条规则是，任务是按照提交的顺序来执行的。所以在我们的例子中，我们可以保证任务1在任务2之前被执行。这对于我们的任务排序是非常重要的。但当然，还可以提出更多问题。首先，我们能否知道一个任务是否已经完成。第二个问题，我们能否取消一个任务的执行。第一个问题的答案是否定的。事实上，在这种情况下，当我们使用runnable时，不可能通过查询Executor来知道某个任务是否被执行。第二，我们能否取消任务的执行。在某种程度上，我们可以。事实上，我们能做的是将一个任务从等待队列中移除。如果任务已经被线程启动，那么就不可能取消它。</p> <div class=highlight><pre><span></span><code>    <span class=n>Executor</span> <span class=n>executor</span><span class=o>=</span> <span class=n>Executors</span><span class=p>.</span><span class=na>newSingleThreadExecutor</span><span class=p>();</span>
    <span class=n>Runnable</span> <span class=n>task1</span><span class=o>=</span> <span class=p>()</span> <span class=o>-&gt;</span> <span class=n>someReallyLongProcess</span><span class=p>();</span>
    <span class=n>Runnablet</span> <span class=n>ask2</span><span class=o>=</span> <span class=p>()</span> <span class=o>-&gt;</span> <span class=n>anotherReallyLongProcess</span><span class=p>();</span>
    <span class=n>executor</span><span class=p>.</span><span class=na>execute</span><span class=p>(</span><span class=n>task1</span><span class=p>);</span>
    <span class=n>executor</span><span class=p>.</span><span class=na>execute</span><span class=p>(</span><span class=n>task2</span><span class=p>);</span>

<span class=c1>// Can we know if a task is done or not? No…</span>
<span class=c1>// Can we cancel the execution of a task? Yes, if the task has not started yet</span>
</code></pre></div> <h4 id=executor_2>Executor服务模式的总结<a class=headerlink href=#executor_2 title="Permanent link">&para;</a></h4> <p>好了，让我们快速总结一下我们所看到的关于Executor模式的内容。首先，建立一个执行器比按需创建线程更有效率。创建一个Executor或ExecutorService将在创建这个Executor时创建一个线程池，只要这个Executor还活着，这些线程就会一直活着。所以一个给定的线程可以根据我们的需要执行很多任务。其次，我们可以将Runnable的实例传递给Executor。Executor有一个等待队列来处理它的请求可能比可用的线程多的事实。如果我们愿意，我们可以要求Executor从等待队列中删除一个任务。所以我们可以看到，使用Executor模式比使用基本的Runnable模式更有效率，而且它与Runnable模式并不冲突，因为它可以使用相同的任务。</p> <h3 id=runnable-callable>从Runnable 到 Callable<a class=headerlink href=#runnable-callable title="Permanent link">&para;</a></h3> <h4 id=runnable_1>Runnable有什么问题？<a class=headerlink href=#runnable_1 title="Permanent link">&para;</a></h4> <p>现在我们看到了如何使用Executor模式在JDK中创建线程池，让我们仔细看看runnable接口本身。所以我们看到，我们可以使用runnable接口对一个任务进行建模，使其在另一个线程中执行。现在，这个可运行接口有几个注意事项。首先，我们写的方法不能返回任何东西。这意味着什么呢？首先，它意味着不能返回任何对象，也不能引发任何异常。假设我们的任务涉及某种数据库的查询。数据库查询是我们可能希望在另一个线程中执行的，因为它可能是一个长期运行的过程。这个查询可能会持续较长时间，在JDK中标准的方法是抛出一个SQL异常，如果顺利的话，它将简单地产生一个结果。这个结果或这个异常不能通过Runnable任务传输。事实上，我们没有办法知道一个任务是否已经完成，是否已经正常完成或异常完成，而且这个任务不能产生任何结果。</p> <p>所以我们有几个问题。首先，一个任务如何能返回值？第二个问题，我们怎样才能得到这个任务引发的异常，比如说IO异常或SQL异常。第三，我们需要一种方法来将这个值或异常从一个线程传送到另一个线程。为什么呢？因为一个任务是在一个给定的线程中创建的，并传递给一个Executor Service的线程，而正是在这最后一个线程中，异常的结果被创建。所以我们需要为我们的任务建立一个新的模型。runnable接口的情况是，一个任务是一个接口的方法，但这个方法必须返回一个值，并且必须能够抛出一个异常。而runnable接口的run方法却不是这样的。而且我们还需要一个新的对象，它将作为属于Executor的执行线程和创建任务的主线程之间的桥梁。</p> <h3 id=runnable->Runnable接口 -- 建模任务<a class=headerlink href=#runnable- title="Permanent link">&para;</a></h3> <p>如果我们看一下Runnable接口，它是这样写的，只有一个运行方法，不返回任何东西，也不抛出任何异常。现在，Executor模式使用了另一个叫做Callable接口的接口。Callable接口是一个生成接口。它和Runnable接口一样有一个名为call的方法。这个调用方法返回一个类型为V的对象，并且可以抛出一个异常，所以它所做的正是我们需要的。正如我们看到的，Executor接口并不直接处理callable。它有一个以runnable为参数的单一方法。但是Executor Service接口有一个提交方法，它接受一个可调用对象作为参数。所以要使用可调用的任务，我们必须使用ExecutorServices而不是Executors。现在，正如我们在上一部分看到的，ExecutorServices的实现与Executor接口的实现相同，这个方法返回一个Future Object，也是一个通用对象。事实上，这个对象是对任务返回的对象的一个封装，但它也有我们将要看到的特殊功能。</p> <div class=highlight><pre><span></span><code><span class=nd>@FunctionalInterface</span>
<span class=kd>public</span> <span class=kd>interface</span> <span class=nc>Runnable</span><span class=p>{</span>
    <span class=kt>void</span> <span class=nf>run</span><span class=p>();</span>
<span class=p>}</span>

<span class=nd>@FunctionalInterface</span>
<span class=kd>public</span> <span class=kd>interface</span> <span class=nc>Callable</span><span class=o>&lt;</span><span class=n>V</span><span class=o>&gt;</span><span class=p>{</span>
    <span class=n>V</span> <span class=nf>call</span><span class=p>()</span> <span class=kd>throws</span> <span class=n>Exception</span><span class=p>;</span>
<span class=p>}</span>

<span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>Future</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=nf>submit</span><span class=p>(</span><span class=n>Callable</span> <span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=n>task</span><span class=p>);</span> 
</code></pre></div> <h4 id=introducing-the-future-object-to-transmit-objects-between-threads>Introducing the Future Object to Transmit Objects Between Threads<a class=headerlink href=#introducing-the-future-object-to-transmit-objects-between-threads title="Permanent link">&para;</a></h4> <p>这个Future Object是如何工作的呢？好吧，假设我们在主线程中创建了一个可调用对象。这是我们想在我们的Executor中执行的任务，所以我们把这个任务传递给这个Executor的提交方法。然后，这个任务从主线程被传送到ExecutorService。现在，ExecutorService将在它自己的线程池中执行这个任务，当然，这与主线程不同。这个特殊的线程将创建一个结果，无论它是一个正常的结果还是一个异常。然后，执行者将不得不把这个对象从它的线程传递给创建任务的主线程。这正是这个Future对象的作用。事实上，Executor将返回一个Future对象，该对象将保存该任务的执行结果，一旦它可用。它在代码中是如何工作的？我在主线程中创建任务，然后提交这个任务，这个提交方法将立即返回一个Future对象，其类型与可调用对象的类型相同。然后我可以调用这个Future对象的get方法。我可以在调用这个get方法之前执行一些其他代码。当我调用这个get方法时，会发生两件事。第一，任务产生的对象是可用的，所以get方法将立即返回该对象；第二，任务产生的对象还不可用。在这种情况下，get方法将不会立即返回。它将阻塞，直到我们例子中的字符串可用。</p> <p><img alt=excuter_works src=../../images/concurrency/excuter_works.gif></p> <h4 id=wrapping-up-callables-and-futures-handling-exceptions>Wrapping-up Callables and Futures, Handling Exceptions<a class=headerlink href=#wrapping-up-callables-and-futures-handling-exceptions title="Permanent link">&para;</a></h4> <p>现在，如果事情出了差错，有两个异常可以被引发。首先是InterruptedException。如果正在执行这个任务的执行器的线程被中断，就会抛出这个异常。可以通过向Executor发出关闭命令来中断这样一个线程。第二种情况是，任务本身抛出了一个异常。想象一下，一个数据库的查询出现了某种错误，所以在任务内部引发了一个SQL异常。那么在这种情况下，get方法将把这个根本性的异常包裹在ExecutionException中，并把它扔到主线程中。所以简而言之，这个get方法可能会抛出两种异常，InterruptedException，意味着Executor本身出了问题，或者ExecutionException来包裹任务抛出的应用异常。所以future.get方法是这样工作的。第一种情况，任务正常完成，那么get方法将立即返回产生的结果（如果它是可用的），如果不是这样，get方法将阻塞直到结果准备好。第二种情况，get方法抛出了一个异常。那么这个异常就被包裹在ExecutionException中，并被get调用抛出。还有一种可能，我们也可以给get调用传递一个超时，以避免被无限期地阻塞。例如，如果我们认为结果应该在一秒钟内得到，我们可以给这个get方法传递1秒钟的时间，然后get方法会抛出一个InterruptedException。</p> <h4 id=_1>示例代码<a class=headerlink href=#_1 title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><span class=kn>package</span> <span class=nn>org.xkx.executors</span><span class=p>;</span>

<span class=kn>import</span> <span class=nn>java.util.concurrent.ExecutorService</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.concurrent.Executors</span><span class=p>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>PlayingWithExecutorsAndRunnables</span> <span class=p>{</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>

        <span class=n>Runnable</span> <span class=n>task</span> <span class=o>=</span> <span class=p>()</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;I am in thread &quot;</span> <span class=o>+</span> <span class=n>Thread</span><span class=p>.</span><span class=na>currentThread</span><span class=p>().</span><span class=na>getName</span><span class=p>());</span>

        <span class=c1>// ExecutorService service = Executors.newSingleThreadExecutor();</span>
        <span class=n>ExecutorService</span> <span class=n>service</span> <span class=o>=</span> <span class=n>Executors</span><span class=p>.</span><span class=na>newFixedThreadPool</span><span class=p>(</span><span class=mi>4</span><span class=p>);</span>

        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span> <span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>10</span> <span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
            <span class=c1>// new Thread(task).start();</span>
            <span class=n>service</span><span class=p>.</span><span class=na>execute</span><span class=p>(</span><span class=n>task</span><span class=p>);</span>
        <span class=p>}</span>

        <span class=n>service</span><span class=p>.</span><span class=na>shutdown</span><span class=p>();</span>

    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=kn>package</span> <span class=nn>org.xkx.executors</span><span class=p>;</span>

<span class=kn>import</span> <span class=nn>java.util.concurrent.Callable</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.concurrent.ExecutionException</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.concurrent.ExecutorService</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.concurrent.Executors</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.concurrent.Future</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.concurrent.TimeUnit</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.concurrent.TimeoutException</span><span class=p>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>PlayingWithCallablesAndFutures</span> <span class=p>{</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>ExecutionException</span><span class=p>,</span> <span class=n>InterruptedException</span> <span class=p>{</span>

        <span class=n>Callable</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>task</span> <span class=o>=</span> <span class=p>()</span> <span class=o>-&gt;</span> <span class=p>{</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=p>(</span><span class=s>&quot;I throw an exception in thread &quot;</span> <span class=o>+</span> <span class=n>Thread</span><span class=p>.</span><span class=na>currentThread</span><span class=p>().</span><span class=na>getName</span><span class=p>());</span>
        <span class=p>};</span>

        <span class=n>ExecutorService</span> <span class=n>executor</span> <span class=o>=</span> <span class=n>Executors</span><span class=p>.</span><span class=na>newFixedThreadPool</span><span class=p>(</span><span class=mi>4</span><span class=p>);</span>

        <span class=k>try</span> <span class=p>{</span>
            <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>10</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
                <span class=n>Future</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>future</span> <span class=o>=</span> <span class=n>executor</span><span class=p>.</span><span class=na>submit</span><span class=p>(</span><span class=n>task</span><span class=p>);</span>
                <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;I get: &quot;</span> <span class=o>+</span> <span class=n>future</span><span class=p>.</span><span class=na>get</span><span class=p>());</span>
            <span class=p>}</span>
        <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
            <span class=n>executor</span><span class=p>.</span><span class=na>shutdown</span><span class=p>();</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <div class="admonition notes"> <p class=admonition-title>Notes</p> <ol> <li>newSingleThreadExecutor()-an executor with only one thread </li> <li>newFixedThreadPool(poolSize)-an executor with poolSizethreads </li> <li>newCachedThreadPool()-creates threads on demand-keeps unused threads for 60s-then terminates them </li> <li>newScheduledThreadPool(poolSize)-creates a pool of threads-returns a ScheduledExecutorService </li> </ol> </div> <div class="admonition notes"> <p class=admonition-title>Notes</p> <p>The ScheduledExecutorService:<br> - schedule(task, delay) <br> - scheduleAtFixedRate(task, delay, period)<br> - scheduleWithFixedDelay(task, initialDelay, delay) </p> </div> <div class="admonition notes an executorserviceneeds to be properly shutdown"> <p class=admonition-title>Notes<p>1) shutdown()<br> - continue to execute all submitted tasks,<br> - execute waiting tasks,<br> - do not accept new tasks-then shutdown<br> 1) shutdownNow()<br> - halt the running tasks,<br> - do not execute waiting tasks,<br> - then shutdown<br> 1) awaitTermination(timeout)<br> - shutdown()<br> - wait for the timeout,<br> - if there are remaining tasks, then halt everything </p> </p> </div> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top data-md-state=hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../cp-overview/ class="md-footer__link md-footer__link--prev" aria-label="Previous: 高级Java并发模式" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> 高级Java并发模式 </div> </div> </a> <a href=../lock-sema-pro-con/ class="md-footer__link md-footer__link--next" aria-label="Next: 在生产者/消费者模式中使用锁和semaphores" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> 在生产者/消费者模式中使用锁和semaphores </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2021 XKX </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://github.com/xkx9431 target=_blank rel=noopener title=github.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://www.zhihu.com/people/triumphxu target=_blank rel=noopener title=www.zhihu.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><path d="M170.54 148.13v217.54l23.43.01 7.71 26.37 42.01-26.37h49.53V148.13H170.54zm97.75 193.93h-27.94l-27.9 17.51-5.08-17.47-11.9-.04V171.75h72.82v170.31zm-118.46-94.39H97.5c1.74-27.1 2.2-51.59 2.2-73.46h51.16s1.97-22.56-8.58-22.31h-88.5c3.49-13.12 7.87-26.66 13.12-40.67 0 0-24.07 0-32.27 21.57-3.39 8.9-13.21 43.14-30.7 78.12 5.89-.64 25.37-1.18 36.84-22.21 2.11-5.89 2.51-6.66 5.14-14.53h28.87c0 10.5-1.2 66.88-1.68 73.44H20.83c-11.74 0-15.56 23.62-15.56 23.62h65.58C66.45 321.1 42.83 363.12 0 396.34c20.49 5.85 40.91-.93 51-9.9 0 0 22.98-20.9 35.59-69.25l53.96 64.94s7.91-26.89-1.24-39.99c-7.58-8.92-28.06-33.06-36.79-41.81L87.9 311.95c4.36-13.98 6.99-27.55 7.87-40.67h61.65s-.09-23.62-7.59-23.62v.01zm412.02-1.6c20.83-25.64 44.98-58.57 44.98-58.57s-18.65-14.8-27.38-4.06c-6 8.15-36.83 48.2-36.83 48.2l19.23 14.43zm-150.09-59.09c-9.01-8.25-25.91 2.13-25.91 2.13s39.52 55.04 41.12 57.45l19.46-13.73s-25.67-37.61-34.66-45.86h-.01zM640 258.35c-19.78 0-130.91.93-131.06.93v-101c4.81 0 12.42-.4 22.85-1.2 40.88-2.41 70.13-4 87.77-4.81 0 0 12.22-27.19-.59-33.44-3.07-1.18-23.17 4.58-23.17 4.58s-165.22 16.49-232.36 18.05c1.6 8.82 7.62 17.08 15.78 19.55 13.31 3.48 22.69 1.7 49.15.89 24.83-1.6 43.68-2.43 56.51-2.43v99.81H351.41s2.82 22.31 25.51 22.85h107.94v70.92c0 13.97-11.19 21.99-24.48 21.12-14.08.11-26.08-1.15-41.69-1.81 1.99 3.97 6.33 14.39 19.31 21.84 9.88 4.81 16.17 6.57 26.02 6.57 29.56 0 45.67-17.28 44.89-45.31v-73.32h122.36c9.68 0 8.7-23.78 8.7-23.78l.03-.01z"/></svg> </a> <a href=https://www.linkedin.com/in/%E5%87%AF%E6%97%8B-%E8%A8%B1-983884103/ target=_blank rel=noopener title=www.linkedin.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "navigation.indexes", "navigation.instant", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.8397ff9e.min.js", "version": null}</script> <script src=../../assets/javascripts/bundle.1e84347e.min.js></script> </body> </html>